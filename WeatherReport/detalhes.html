<html>
	<head>
		<title>Weather Report</title>
	
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
		<script src="https://code.jquery.com/jquery-3.4.0.min.js" integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=" crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
		<script src="js/jquery-confirm.min.js" type="text/javascript"></script>
		
		<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
		<link href="js/jquery-confirm.min.css" rel="stylesheet">
		
		<script>
			$(document).ready(function(){
				 $(document).tooltip();
				
				function InitCap(txt){
					return txt.charAt(0).toUpperCase() + txt.slice(1);
				}			
			
				$.getJSON("cities.json", function(data){
					for(reg in data.cities){
						$.ajax({
							url: "https://api.openweathermap.org/data/2.5/forecast",
							data: "id=" + data.cities[reg].id +
								  "&appid=eb8b1a9405e659b2ffc78f0a520b1a46",
							type: "GET",
							success: function(ret){
								nome_cidade = ret.city.name;
								nome_pais = ret.city.country;
								//console.log("["+ret.city.country+"] "+nome_cidade);
								$("#container_cidades").append('<span class="badge badge-primary btn_cidade" title="Clique para detalhes..." cidade="'+nome_cidade+'">'+"["+ret.city.country+"] "+nome_cidade+'</span>');
								
								var arrDataHora = [];
								var arrTemperatura = [];
								var arrCeu = [];
								for(p in ret.list){
									//Data e Hora
									arrDataHora.push(ret.list[p].dt_txt);
									
									//Temperatura
									temperatura = ret.list[p].main.temp-273.15
									arrTemperatura.push(temperatura.toFixed(2));
									
									//Ceu
									arrCeu.push(InitCap(ret.list[p].weather[0].description));
								
								}
								console.log(arrDataHora);
								console.log(arrTemperatura);
								console.log(arrCeu);
							},
							error: function (ret){

							}
						});
						//console.log(data.cities[r].id);
					}
				});
				
				$(document).on('click', ".btn_cidade", function(e){
					$.ajax({
						url: "detalhes.html",
						success: function(data){
							$("#dialog").html(data);
						}   
					});
				});
			
				$("#btn_busca_cidade").click(function(){
					if($("#txt_busca_cidade").val() == ""){
						$.alert({
							title: 'Erro',
							content: 'Preencha a cidade.',
							type: 'red'
						});
						return;
					}else{
						$.ajax({
							url: "https://api.openweathermap.org/data/2.5/weather",
							data: "q=" + $("#txt_busca_cidade").val() +
								  "&appid=eb8b1a9405e659b2ffc78f0a520b1a46",
							type: "GET",
							success: function(ret){
								
							},
							error: function (ret){
								if(ret.status == 404){
									$.alert({
										title: 'Erro',
										content: 'Cidade não encontrada.',
										type: 'red'
									});
								}
							}
						});
					}
				});
			});
		</script>
		<style>
			.badge{
				margin: 0px 7px 0px 7px;
				padding: 10px;
				cursor: pointer;
			}
			.badge:hover{
				box-shadow: 1px 3px 5px #999;
			}
		</style>
		
	</head>
	<body>
		<div class="jumbotron">
			<h1>Weather Report</h1>
		</div>
		<div class="container-fluid">
			<p class="lead">
				Cadastre aqui as cidades que deseja visualizar a previsão do tempo.
			</p>
			<div class='row'>
				<div class='col-md-6'>
					<input type="text" id="txt_busca_cidade" class="form-control" placeholder="Busque pelo nome da cidade...">
				</div>
				<div class='col-md-6'>
					<button type="button" id="btn_busca_cidade" class="btn btn-primary">Cadastrar</button>
				</div>
			</div>
			<p class="lead" style='margin-top: 20px;'>
				Cidades cadastradas:
			</p>
			<div class='row'>
				<div class='col-md-12' id='container_cidades'></div>
			</div>
			<div id="dialog"></div>
		</div>
	</body>
</html>